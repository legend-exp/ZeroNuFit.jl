<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Likelihood implementation · ZeroNuFit.jl</title><meta name="title" content="Likelihood implementation · ZeroNuFit.jl"/><meta property="og:title" content="Likelihood implementation · ZeroNuFit.jl"/><meta property="twitter:title" content="Likelihood implementation · ZeroNuFit.jl"/><meta name="description" content="Documentation for ZeroNuFit.jl."/><meta property="og:description" content="Documentation for ZeroNuFit.jl."/><meta property="twitter:description" content="Documentation for ZeroNuFit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ZeroNuFit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Likelihood implementation</a><ul class="internal"><li><a class="tocitem" href="#Likelihood-Function"><span>Likelihood Function</span></a></li><li><a class="tocitem" href="#Likelihood-implementation"><span>Likelihood implementation</span></a></li><li><a class="tocitem" href="#Free-parameter-priors"><span>Free parameter priors</span></a></li></ul></li><li><a class="tocitem" href="../installation/">First steps</a></li><li><a class="tocitem" href="../config/">Configuration file</a></li><li><a class="tocitem" href="../inputs/">Partitions and events</a></li><li><a class="tocitem" href="../toys/">Generating toys</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Likelihood implementation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Likelihood implementation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/legend-exp/ZeroNuFit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/legend-exp/ZeroNuFit.jl/blob/main/docs/src/likelihood.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>Table of contents:</p><ul><li class="no-marker"><ul><li><a href="#Likelihood-Function">Likelihood Function</a></li><li><a href="#Likelihood-implementation">Likelihood implementation</a></li><li><a href="#Free-parameter-priors">Free parameter priors</a></li><li class="no-marker"><ul><li><a href="#Marginalization-and-posterior-distributions">Marginalization and posterior distributions</a></li></ul></li></ul></li></ul><h2 id="Likelihood-Function"><a class="docs-heading-anchor" href="#Likelihood-Function">Likelihood Function</a><a id="Likelihood-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihood-Function" title="Permalink"></a></h2><p>The implemented unbinned Likelihood function reads as: </p><p class="math-container">\[\begin{aligned}
    \mathcal{L}(\Gamma) = \prod_k \bigg[ \textrm{Pois}(s_k+b_k) \bigg[ \prod_{i_k=1}^{N_k} \frac{1}{s_k + b_k} \left( b_k\cdot p_{\rm b}(E) + s_{\rm k}\cdot p_{\rm s}(E) \right)  \bigg] \bigg]
\end{aligned}\]</p><p>Here, the first product runs over the number of partitions <em>k</em> (<span>$N_{\rm p}$</span> partitions in total) and the second over the events <em>i</em> in a given partition (<span>$N_{\rm k}$</span> events in total).</p><p>In case no events are found in a given partition <em>k</em>, the above Likelihood expression simplifies into</p><p class="math-container">\[\begin{aligned}
    \mathcal{L}(\Gamma) = \prod_k \textrm{Pois}(s_k+b_k) 
\end{aligned}\]</p><p>The terms <span>$p_{\rm b}(E)$</span> and <span>$p_{\rm s}(E)$</span> represent the background and signal distributions, respectively, both expressed as a function of energy <span>$E$</span>. The background distribution can be selected among different options: flat, linear or exponential. The signal distribution can be expressed in the following way</p><p class="math-container">\[\begin{aligned}
    p_{\rm s}(E) = \frac{dP(E_{\rm i} | Q_{\beta\beta} - \Delta_{\rm k}, \omega_{\rm k})}{dE} 
\end{aligned}\]</p><p>for a given energy <span>$E_{\rm i}$</span> of an event falling in the analysis window for the partition <em>k</em> with energy bias <span>$\Delta_{\rm k}$</span> and energy width <span>$\omega_{\rm k}$</span>. Here, we are assuming the energy biases were defined as <span>$E_{\rm true} - E_{\rm cal}$</span>. Thus, we correct for the energy bias by adding the calculated bias to the calibrated event energy.</p><p>Taking <span>$x=Q_{\beta\beta} - \Delta_{\rm k}$</span>, the signal energy distribution for each partition can be taken as a Gaussian (e.g. for GERDA/LEGEND), </p><p class="math-container">\[\begin{aligned}
\frac{dP(E | x, \sigma)}{dE} = \frac{1}{\sqrt{2\pi\sigma^2}} \times e^{-\frac{\left(E - x \right)^2}{2 \sigma ^2}}
\end{aligned}\]</p><p>Alternatively, the signal energy distribution can also be shaped as a Gaussian with a tail at low energies (e.g. for MAJORANA DEMONSTRATOR), </p><p class="math-container">\[\begin{aligned}
\frac{dP(E | x, \gamma)}{dE} = \frac{1-f}{\sqrt{2\pi(\gamma \sigma)^2}} \times e^{-\frac{\left(E - x \right)^2}{2 (\gamma \sigma) ^2}}+\frac{f}{2\gamma\tau}\times e^{ \frac{(\gamma \sigma)^2}{2(\gamma\tau)^2} + \frac{E-x}{\gamma\tau} } \times erfc \left(\frac{\sigma}{\sqrt{2}\tau}+ \frac{E-x}{\sqrt{2}\gamma\sigma} \right)
\end{aligned}\]</p><p>where <span>$f$</span> is the fraction of events in the tail (taken as fixed), <span>$\tau$</span> is the scale parameter of the tail. The <span>$\gamma$</span> parameter correlates the uncertainties on both <span>$\sigma$</span> and <span>$\tau$</span> by simultaneously scaling <span>$\sigma$</span> and <span>$\tau$</span> with nominal value <span>$\tilde{\gamma} = 1$</span> and uncertainty <span>$\delta_\gamma$</span>. Therefore, <span>$\sigma$</span> and <span>$\tau$</span> are taken as fixed parameters and all uncertainty is handled by <span>$\gamma$</span>.</p><p>The background and signal counts, i.e. <span>$b_{\rm k}$</span> and <span>$s_{\rm k}$</span> respectively, are defined as</p><p class="math-container">\[\begin{aligned}
b_{\rm k} = \mathcal{B}_{\rm b} \cdot \Delta E \cdot \mathcal{E}_{\rm k}
\end{aligned}\]</p><p>and</p><p class="math-container">\[\begin{aligned}
s_{\rm k} = \frac{\text{ln}\,2\,\mathcal{N}_{\rm A}}{m_{\rm 76}} \cdot (\varepsilon_{\rm k} + \alpha \cdot \sigma_{\varepsilon_{\rm k}}) \cdot \mathcal{E}_{\rm k} \cdot \Gamma
\end{aligned}\]</p><p>Notice that an extra index <span>$b$</span> was introduced to account for different background indexes <span>$\mathcal{B}_{\rm b}$</span> that might be shared across different partitions. In particular, for a given partition <em>k</em>, <span>$\mathcal{E}_{\rm k}$</span> is the exposure, <span>$\Delta E$</span> is the net width of the fit window, <span>$\varepsilon_{\rm k}$</span> is the efficiency with uncertainty <span>$\sigma_{\varepsilon_{\rm k}}$</span> and <span>$\Gamma$</span> is the signal rate.</p><h2 id="Likelihood-implementation"><a class="docs-heading-anchor" href="#Likelihood-implementation">Likelihood implementation</a><a id="Likelihood-implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihood-implementation" title="Permalink"></a></h2><p>In our framework, the above Likelihood product was evaluated taking the logarithm of it.  We defined our &quot;log Likelihood&quot; (<span>$LL$</span>) as:</p><p class="math-container">\[\begin{aligned}
    LL(\Gamma)  = \underbrace{\sum_{\rm j}\sum_{\rm i_{\rm k}=1}^{N_{\rm k}} \left[\text{log}\left(Pois(b_{\rm j}+s_{\rm j})\right) + \text{log}\left(b_{\rm j} \cdot p_{\rm b}(E) + s_{\rm j} \cdot p_{\rm s}(E) \right) - \text{log}\left(b_{\rm j}+s_{\rm j} \right) \right]}_{N_{\rm k}\text{ events in $j$}} - \underbrace{\sum_{l} \left(b_{l}+s_{l} \right)}_{\text{0 events in $l$}}
\end{aligned}\]</p><p>The sum over all partitions <span>$k$</span> was separated in a sum over partitions containing an event <span>$i$</span> (<span>$j$</span>) and in a sum over partitions with no events (<span>$l$</span>).</p><h2 id="Free-parameter-priors"><a class="docs-heading-anchor" href="#Free-parameter-priors">Free parameter priors</a><a id="Free-parameter-priors-1"></a><a class="docs-heading-anchor-permalink" href="#Free-parameter-priors" title="Permalink"></a></h2><p>Different free prameters can be identified within the framework:</p><ul><li>signal, <span>$\Gamma$</span></li><li>background indeces, <span>$\mathcal{B}_{\rm b}$</span> (with <span>$b=1,\,...,\,N$</span>)</li><li>energy bias at <span>$Q_{\beta\beta}$</span>, <span>$\Delta = E_{\textrm{true}} - E_{\textrm{cal}}$</span> (keV)</li><li>energy resolution, <span>$\sigma$</span> (keV)</li><li>peak shape scale parameter, <span>$\gamma$</span> (for the modified Gaussian peak shape only)</li><li>signal efficiencies, <span>$\varepsilon$</span></li></ul><p>For the signal prior, either a uniform or a <span>$1/\sqrt{\Gamma}$</span> prior can be used.</p><p>For the background indeces, a uniform prior can be used.</p><p>For nuisance parameters <span>$\theta$</span> (energy biases, energy resolutions and efficiencies), Gaussian distributions centred around the true values were used</p><p class="math-container">\[\begin{aligned}
    \mathcal{P}(\boldsymbol{\theta}) =\mathcal{P}(\alpha) \cdot  \prod_{\rm k} \mathcal{P}_{\rm k}(\Delta)\cdot \mathcal{P}_{\rm k}(\sigma) =  e^{-\alpha^2/2} \cdot \prod_{\rm k} \frac{1}{\sqrt{2\pi}\sigma_{\Delta_{\rm k}}} \,
      e^{-\frac{\left(\Delta_{\rm k} - \widehat{\Delta}_{\rm k}  \right)^2}{2 \sigma_{\Delta_{\rm k}} ^2}} \cdot
      \frac{1}{\sqrt{2\pi}\sigma_{\sigma_{\rm k}}} \,
      e^{-\frac{\left(\sigma_{\rm k} - \widehat{\sigma}_{\rm k}  \right)^2}{2 \sigma_{\sigma_{\rm k}} ^2}}
\end{aligned}\]</p><p>Alternatively, the code allows the user to fix energy biases, energy resolutions and efficiencies at their true values, removing any prior constraint. Another feature of the framework includes the possibility to correlate energy biases and resolutions via a unique term, <span>$\alpha_{\rm bias}$</span> or <span>$\alpha_{\rm reso}$</span>, as it is done for the efficiencies in the above case. Indeed, <span>$\alpha$</span> is used as a scaling parameter that fully correlated the efficiency uncertainties across all partitions, with nominal value of 0 and standard deviation of 1. Separating each partition efficiency into uncorrelated components and adding a nuisance parameter for each would require a great deal of CPU. </p><p>Accounting for the different signal shape (i.e. modified Gaussian with a tail at low energies), we includeed a Gaussian prior term for the peak position offset (<span>$\mu$</span>) and the peak shape scale parameter (<span>$\gamma$</span>):</p><p class="math-container">\[\begin{aligned}
      \mathcal{P}_{\rm mod.}(\boldsymbol{\theta}) =\mathcal{P}(\alpha) \cdot   \prod_{\rm k} \mathcal{P}_{\rm k}(\mu)\cdot \mathcal{P}_{\rm k}(\sigma)=e^{-\alpha^2/2} \cdot\prod_{\rm k}  \frac{1}{\sqrt{2\pi}\sigma_{\mu_{\rm k}}} \,
      e^{-\frac{\left(\mu_{\rm k} - \widehat{\mu}_{\rm k}  \right)^2}{2 \sigma_{\mu_{\rm k}} ^2}} \cdot
      \frac{1}{\sqrt{2\pi}\sigma_{\gamma_{\rm k}}} \,
      e^{-\frac{\left(\gamma_{\rm k} - \widehat{\gamma}_{\rm k}  \right)^2}{2 \sigma_{\gamma_{\rm k}} ^2}}  
\end{aligned}\]</p><p>In the code, the product of priors was further simplified by introducing a prior term only for those partitions <span>$j$</span> for which there is at least an event.  The above products, then, can be expressed again as</p><p class="math-container">\[\begin{aligned}
    \mathcal{P}(\boldsymbol{\theta}) =\mathcal{P}(\alpha) \cdot  \prod_{\rm j} \mathcal{P}_{\rm j}(\Delta)\cdot \mathcal{P}_{\rm j}(\sigma) \text{\, and \,}
    \mathcal{P}_{\rm mod.}(\boldsymbol{\theta}) =\mathcal{P}(\alpha) \cdot  \prod_{\rm j} \mathcal{P}_{\rm j}(\mu)\cdot \mathcal{P}_{\rm j}(\sigma)
\end{aligned}\]</p><h3 id="Marginalization-and-posterior-distributions"><a class="docs-heading-anchor" href="#Marginalization-and-posterior-distributions">Marginalization and posterior distributions</a><a id="Marginalization-and-posterior-distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Marginalization-and-posterior-distributions" title="Permalink"></a></h3><p>The combined posterior probability density function is calculated according to Bayes’ theorem as:</p><p class="math-container">\[\begin{aligned}
    \mathcal{P}(\Gamma,\, \boldsymbol{BI},\, \boldsymbol{\theta}|D ) \propto \underbrace{\mathcal{L}(\Gamma,\, \boldsymbol{BI},\,\boldsymbol{\theta}|D)}_{\text{Likelihood}} \cdot \underbrace{\mathcal{P}(\boldsymbol{\theta}) \cdot \mathcal{P}(\Gamma)\cdot \prod_{\rm b=1}^{N_{\rm b}} \mathcal{P}_{\rm b}(BI)}_{\text{prior terms}}
\end{aligned}\]</p><p>where <span>$D$</span> are our data, i.e. the energy events surviving all cuts in the fit window.  Here, we expressed the general case where a total number of <span>$N_{\rm b}$</span> BIs are introduced. </p><p>The marginalization is performed with the BAT toolkit via a Markov chain Monte Carlo (MCMC) numerical integration. The marginalization used the Metropolis-Hastings sampling algorithm implemented in BAT.  The number of MCMC chains and the number of steps in each MCMC can be selected by the user.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../installation/">First steps »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 14 February 2025 17:24">Friday 14 February 2025</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
